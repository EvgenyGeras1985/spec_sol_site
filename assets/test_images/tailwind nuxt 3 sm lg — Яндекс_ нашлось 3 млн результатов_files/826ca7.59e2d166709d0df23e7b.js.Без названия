(window.serpWebpackJsonp=window.serpWebpackJsonp||[]).push([["826ca7"],{lEnD:function(e,t,n){"use strict";n.r(t),n.d(t,"VoiceInput",(function(){return H}));var r={};n.r(r),n.d(r,"be",(function(){return _})),n.d(r,"en",(function(){return N})),n.d(r,"id",(function(){return P})),n.d(r,"kk",(function(){return A})),n.d(r,"ru",(function(){return x})),n.d(r,"tr",(function(){return z})),n.d(r,"tt",(function(){return K})),n.d(r,"uk",(function(){return M})),n.d(r,"uz",(function(){return L}));var i,c=n("4Gwv"),o=n("nAbZ"),u=n("oUqw"),s=n("86Uv"),a=n("cDcd"),d=n("gfRm"),l=n.n(d),f=n("VEeG"),v=n("UWoi"),m=n("KZth"),w=n("Bhl+"),E=function(e){var t=Object(a.useRef)(),r=Object(a.useRef)(!1),i=Object(a.useCallback)((function(){return r.current?Promise.resolve(t.current):function(e){return Promise.all([n.e("332021"),n.e("a84ef0")]).then(n.bind(null,"AXdt")).then((function(t){return(0,t.createASRKit)(e)})).catch((function(t){Object(w.a)({message:"Couldn't create ASRKit. ".concat(t.message),source:"speechkit",additional:e})}))}(e).then((function(e){if(e)return t.current=e,r.current=!0,t.current}))}),[e,r]);return{speechkitRef:t,getSpeechkit:i}},b="home:error",O="home:before-start-recognize",R="home:start-recognize",p="home:speech-kit-init",g="home:speech-kit-access-granted",h="home:recognize-text",S="home:stop-recognize",k="home:permission-request",j={ERROR_INIT:"error-init",ERROR_SPEECH_KIT:"error-speech-kit",SUCCESS_RECOGNIZE:"success-recognize",TIMEOUT_SUCCESS:"timeout-success",TIMEOUT_EMPTY:"timeout-empty"},C=function(e){var t=Object(a.useRef)(null),n=E(e),r=n.speechkitRef,i=n.getSpeechkit,c=Object(a.useRef)(!1),o=Object(a.useRef)(!1),u=Object(a.useRef)(""),s=Object(a.useCallback)((function(e){var n;(function(){var e;return null===(e=t.current)||void 0===e?void 0:e.startedRecognize})()&&(t.current&&(t.current.startedRecognize=!1),o.current&&(null===(n=r.current)||void 0===n||n.stopRecognition()),window.dispatchEvent(new CustomEvent(S,{detail:{type:e,session:t.current}})))}),[r,o]),d=Object(a.useCallback)((function(e){var n,r=e.recognition;if(null===(n=t.current)||void 0===n?void 0:n.startedRecognize){var i=r.text,c=r.finished;i&&(t.current&&(t.current.recognizedText=i),window.dispatchEvent(new CustomEvent(h,{detail:{session:t.current,isDone:c}}))),c&&s(j.SUCCESS_RECOGNIZE)}}),[s]),l=Object(a.useCallback)((function(e){var n=e.error;t.current&&(t.current.startedRecognize=!1),u.current=n.name,window.dispatchEvent(new CustomEvent(b,{detail:{type:j.ERROR_SPEECH_KIT,session:t.current,message:n.message}}))}),[]),f=Object(a.useCallback)((function(){var e;""===(null===(e=t.current)||void 0===e?void 0:e.recognizedText)&&s(j.TIMEOUT_EMPTY)}),[s]),v=Object(a.useCallback)((function(e){e.name!==u.current&&(u.current="",t.current&&(t.current.startedRecognize=!1),window.dispatchEvent(new CustomEvent(b,{detail:{type:j.ERROR_SPEECH_KIT,session:t.current,message:e.message}})))}),[]),m=Object(a.useCallback)((function(e){var n;if("listening"===e)return o.current=!0,void(t.current&&!t.current.startedRecognize&&(null===(n=r.current)||void 0===n||n.stopRecognition()));o.current=!1}),[r]),w=Object(a.useCallback)((function(){r.current&&(c.current||(c.current=!0,r.current.on("status",m),r.current.on("recognition",d),r.current.on("listeningerror",l),r.current.on("listeningend",f),r.current.on("error",v)),t.current&&(t.current.streamer={recorder:{getAnalyserNode:r.current.getAnalyserNode},start:function(){},abort:function(){}}))}),[d,l,f,v,m,r]),R=Object(a.useCallback)((function(e){void 0===navigator.onLine||navigator.onLine?(t.current={recognizedText:"",startedRecognize:!0,maxTime:0},window.dispatchEvent(new CustomEvent(O,{detail:{session:t.current}})),i().then((function(n){n?(w(),window.dispatchEvent(new CustomEvent(k,{detail:{session:t.current}})),n.startRecognition(e),n.once("listeningstart",(function(){window.dispatchEvent(new CustomEvent(g,{detail:{session:t.current}})),window.dispatchEvent(new CustomEvent(p,{detail:{session:t.current}}))}))):window.dispatchEvent(new CustomEvent(b,{detail:{type:j.ERROR_INIT,message:"Failed to get speechkit"}}))}))):window.dispatchEvent(new CustomEvent(b,{detail:{type:j.ERROR_INIT,message:"offline"}}))}),[i,w]);return Object(a.useEffect)((function(){var e=r.current;return function(){null==e||e.off("recognition",d),null==e||e.off("listeningerror",l),null==e||e.off("listeningend",f),null==e||e.off("error")}}),[d,l,f,r]),{startRecognition:R,stopRecognition:s}},y=function(e){var t=Object(a.useRef)(!1),n=Object(a.useRef)([]);return Object(a.useCallback)((function(r,i,c){t.current?c(!0):(n.current.push(c),1===n.current.length&&(function(e){void 0===window.ya&&(window.ya={}),void 0===window.ya.speechkit&&(window.ya.speechkit={}),void 0===window.ya.speechkit._extend?window.ya.speechkit.settings=e:window.ya.speechkit.settings=window.ya.speechkit._extend(e,window.ya.speechkit.settings)}(e),function(e,t,n){var r=document.createElement("script");r.src=e+"/webspeechkit/v-1.0.5/webspeechkit-recognition.min.js",r.async=!0,r.crossOrigin=t?"anonymous":"",r.onload=function(){n(!0)},r.onerror=function(){n(!1),Object(w.a)({message:"Couldn't load Speechkit Script",source:"network"})},document.body.appendChild(r)}(r,i,(function(e){n.current.forEach((function(t){t&&t(e)})),n.current=[],t.current=!0}))))}),[e])},T=function(e){var t=e.speechKitSettings,n=Object(a.useRef)(null),r=y(t),i=Object(a.useCallback)((function(e){try{var t=new window.ya.speechkit.SpeechRecognition;n.current=t,e({streamer:t})}catch(r){e({err:"Error at SpeechStreamer create"})}}),[]),c=Object(a.useCallback)((function(e,t){n.current?t({streamer:n.current}):window.ya&&window.ya.speechkit&&window.ya.speechkit.SpeechRecognition?i(t):r(e.origin,e.crossOrigin,(function(e){e?setTimeout(i,0,t):t({err:"Error when loading webspeechkit"})}))}),[i,r]);return{streamer:n,getStreamer:c}},I=function(e){var t=Object(a.useRef)(null),n=Object(a.useRef)(0),r=Object(a.useRef)(null),i=Object(a.useRef)(void 0),c=Object(a.useRef)(void 0),o=Object(a.useRef)(null),u=T({speechKitSettings:e}).getStreamer;return Object(a.useMemo)((function(){var e=function(){var e;return null===(e=r.current)||void 0===e?void 0:e.startedRecognize},s=function(){var e=r.current;e&&(clearTimeout(e._timerRecognize),e._timerRecognize=void 0)},a=function(){o.current&&o.current.close&&o.current.state&&("closed"!==o.current.state&&o.current.close(),o.current=null)},d=function(t){var n;e()&&(clearTimeout(i.current),s(),r.current&&(r.current.startedRecognize=!1,null===(n=r.current.streamer)||void 0===n||n.abort()),clearTimeout(c.current),c.current=void 0,window.dispatchEvent(new CustomEvent(S,{detail:{type:t,session:r.current}})))},l=function(){var e;r.current&&(r.current._timerRecognize=void 0);var t=Boolean(null===(e=r.current)||void 0===e?void 0:e.recognizedText);d(j[t?"TIMEOUT_SUCCESS":"TIMEOUT_EMPTY"])},f=function(e){var t;r.current&&(r.current.id=e),s(),(null===(t=r.current)||void 0===t?void 0:t.maxTime)&&(r.current._timerRecognize=window.setTimeout(l,r.current.maxTime)),clearTimeout(c.current),c.current=void 0,window.dispatchEvent(new CustomEvent(p,{detail:{session:r.current}}))},v=function(){c.current=window.setTimeout((function(){window.dispatchEvent(new CustomEvent(b,{detail:{type:j.ERROR_SPEECH_KIT,session:r.current,message:"offline"}}))}),5e3),window.dispatchEvent(new CustomEvent(g,{detail:{session:r.current}}))},m=function(e,t){n.current=0,setTimeout((function(){e&&(r.current&&(r.current.recognizedText=e),window.dispatchEvent(new CustomEvent(h,{detail:{session:r.current,isDone:t}}))),t&&d(j.SUCCESS_RECOGNIZE)}),0)},w=function(e){if("MediaDeviceFailedDueToShutdown"===e&&n.current<1)return t.current&&E(t.current),void n.current++;r.current&&(r.current.startedRecognize=!1),clearTimeout(i.current),window.dispatchEvent(new CustomEvent(b,{detail:{type:j.ERROR_SPEECH_KIT,session:r.current,message:e}})),a()};function E(e){var t,n,i=e.codec||window.ya.speechkit.FORMAT.OPUS||window.ya.speechkit.FORMAT.PCM16;null===(n=null===(t=r.current)||void 0===t?void 0:t.streamer)||void 0===n||n.start({lang:e.lang,model:e.recognitionModel,apikey:e.apikey,initCallback:f,accessGrantedCallback:v,dataCallback:m,errorCallback:w,format:i,particialResults:!0,utteranceSilence:Math.max(e.utteranceSilence||0,60),use_snr:Boolean(e.use_snr),yandexuid:e.yandexuid,applicationName:e.applicationName})}return{startRecognition:function(n){if(void 0===navigator.onLine||navigator.onLine){t.current=n,r.current={recognizedText:"",startedRecognize:!0,maxTime:n.maxTime||0===n.maxTime?n.maxTime:6e4},a();try{o.current=o.current||new AudioContext,o.current.createScriptProcessor(256,1,1).disconnect()}catch(c){return void window.dispatchEvent(new CustomEvent(b,{detail:{type:j.ERROR_INIT,message:"AudioContext is not available"}}))}window.dispatchEvent(new CustomEvent(O,{detail:{session:r.current}})),u(n,(function(t){if(t.err||!t.streamer)return window.dispatchEvent(new CustomEvent(b,{detail:{type:j.ERROR_INIT,message:t.err}})),void a();window.ya.speechkit.audiocontext=o.current,r.current&&(r.current.streamer=t.streamer),E(n),window.dispatchEvent(new CustomEvent(R,{detail:{session:r.current}})),i.current=window.setTimeout((function(){e()&&!window.ya.speechkit.isPermissionProvided()&&window.dispatchEvent(new CustomEvent(k,{detail:{session:r.current}}))}),500)}))}else window.dispatchEvent(new CustomEvent(b,{detail:{type:j.ERROR_INIT,message:"offline"}}))},isStartedRecognition:e,stopRecognition:d}}),[u])},_={"Вы заблокировали доступ к микрофону":"Вы заблакіравалі доступ да мікрафона","Неизвестная ошибка":"Невядомая памылка","Отсутствует подключение к интернету, попробуйте ещё раз":"Адсутнічае падключэнне да інтэрнэту, паспрабуйце яшчэ раз","Голосовой поиск":"Галасавы пошук"},N={"Вы заблокировали доступ к микрофону":"You've blocked access to the microphone","Неизвестная ошибка":"Unknown error","Отсутствует подключение к интернету, попробуйте ещё раз":"No internet connection, try again","Голосовой поиск":"Voice search"},P={"Вы заблокировали доступ к микрофону":"Anda telah memblokir akses ke mikrofon","Неизвестная ошибка":"Kesalahan tidak diketahui","Отсутствует подключение к интернету, попробуйте ещё раз":"Tidak ada koneksi internet, coba lagi","Голосовой поиск":"Pencarian suara"},A={"Вы заблокировали доступ к микрофону":"Сіз микрофонға кіруді бұғаттадыңыз ба","Неизвестная ошибка":"Белгісіз қате","Отсутствует подключение к интернету, попробуйте ещё раз":"Интернет байланысы жоқ, тағы байқап көріңіз","Голосовой поиск":"Дауыстық іздеу"},x={"Вы заблокировали доступ к микрофону":"Вы заблокировали доступ к микрофону","Неизвестная ошибка":"Неизвестная ошибка","Отсутствует подключение к интернету, попробуйте ещё раз":"Отсутствует подключение к интернету, попробуйте ещё раз","Голосовой поиск":"Голосовой поиск"},z={"Вы заблокировали доступ к микрофону":"Mikrofona erişimi engellediniz","Неизвестная ошибка":"Bilinmeyen hata","Отсутствует подключение к интернету, попробуйте ещё раз":"İnternet bağlantısı yok, tekrar deneyin","Голосовой поиск":"Sesli arama"},K={"Вы заблокировали доступ к микрофону":"Сез микрофонга керүне тыйдыгыз","Неизвестная ошибка":"Билгесез хата","Отсутствует подключение к интернету, попробуйте ещё раз":"Интернетка тоташу юк, тагын бер тапкыр тырышып карагыз","Голосовой поиск":"Тавыш белән эзләү"},M={"Вы заблокировали доступ к микрофону":"Вы заблокировали доступ к микрофону","Неизвестная ошибка":"Неизвестная ошибка","Отсутствует подключение к интернету, попробуйте ещё раз":"Отсутствует подключение к интернету, попробуйте ещё раз","Голосовой поиск":"Голосовой поиск"},L={"Вы заблокировали доступ к микрофону":"Siz mikrofonga kirishni blokladingiz","Неизвестная ошибка":"Noaniq xatolik","Отсутствует подключение к интернету, попробуйте ещё раз":"Internetga ulanmagan, qayta urining","Голосовой поиск":"Ovozli qidiruv"},U=n("deXl"),D=n("v5zL"),V=n("SeVQ");!function(e){e.PERMISSION_DENIED="permission-denied",e.NO_NETWORK="no-network",e.ASK_FOR_PERMISSION="ask-for-permission",e.UNKNOWN_ERROR="unknown-error",e.RECOGNITION_IN_PROGRESS="recognition-in-progress",e.START_SPEAKING="start-speaking",e.PLEASE_WAIT="please-wait"}(i||(i={}));var F=l()(r);var G=Object(m.a)(v.a),W=l()(r),q=function(e){var t=e.className,n=e.disabled,r=e.isRedesign,c=e.errorCb,s=e.icon,d=e.isActiveVoice,l=e.onSubmit,m=e.onClick,E=e.setInputValue,R=e.setIsActiveVoice,y=e.speechKitSettings,T=e.counterAttributes,_=function(){var e=Object(a.useRef)(null),t=Object(a.useRef)(null),n=Object(a.useRef)(!0),r=Object(a.useRef)();Object(a.useEffect)((function(){e.current=document.querySelector(".".concat(D.g," svg rect"))}),[]);var i=Object(a.useCallback)((function(t){e.current&&(e.current.style.height="".concat(t,"px"))}),[]),c=Object(a.useCallback)((function(e){var n,r;null===(n=t.current)||void 0===n||n.style.setProperty("--local-transition",".3s"),null===(r=t.current)||void 0===r||r.style.setProperty("--local-ripple-scale","".concat(e))}),[]),o=Object(a.useCallback)((function(){clearInterval(r.current),r.current=void 0}),[]),u=Object(a.useCallback)((function(){o(),c(n.current?.1:0),n.current=!n.current,r.current=window.setInterval((function(){c(n.current?.1:0),n.current=!n.current}),400)}),[c,o]);return{buttonRef:t,setRectHeight:i,setRippleScale:c,resetAnimate:function(){var e,n;r.current||(i(0),null===(e=t.current)||void 0===e||e.style.removeProperty("--local-ripple-scale"),null===(n=t.current)||void 0===n||n.style.removeProperty("--local-transition"))},setPulse:u,resetPulse:o}}(),N=_.setRectHeight,P=_.buttonRef,A=_.setRippleScale,x=_.resetAnimate,z=_.setPulse,K=_.resetPulse,M=Object(a.useRef)(),L=Object(a.useRef)(),q=function(e){var t=e.setInputValue,n=e.onSubmit,r=e.speechKitSettings,c=e.errorCb,u=e.buttonRef,s=e.useASR,d=Object(o.e)(Object(a.useState)(!1),2),l=d[0],f=d[1],v=Object(o.e)(Object(a.useState)(0),2),m=v[0],E=v[1],R=Object(o.e)(Object(a.useState)(void 0),2),C=R[0],y=R[1],T=s(r),I=T.startRecognition,_=T.stopRecognition,N=Object(a.useRef)(!1),P=Object(a.useRef)(),A=Object(a.useRef)(),x=Object(a.useCallback)((function(){N.current=!1,f(!1),y(void 0),E(0),A.current&&cancelAnimationFrame(A.current)}),[]),z=Object(a.useCallback)((function(){if(P.current){var e=new Uint8Array(P.current.frequencyBinCount);P.current.getByteFrequencyData(e);var t=e.slice(0,4),n=t.reduce((function(e,t){return e+t}),0)/t.length/D.f;N.current&&E(n),A.current=window.requestAnimationFrame(z)}}),[]),K=Object(a.useCallback)((function(e){return-1!==e.indexOf("Socket error:")||-1!==e.indexOf("Connection closed")||"offline"===e?"ConnectionProblem":-1!==e.indexOf("not allowed")||"MediaDeviceFailedDueToShutdown"===e||"PermissionDismissedError"===e||"PermissionDeniedError"===e||"Permission denied"===e||"Permission dismissed"===e?"PermissionDenied":"other"}),[]);Object(a.useEffect)((function(){if(l){var e=function(){y(i.ASK_FOR_PERMISSION)},t=function(){y(i.ASK_FOR_PERMISSION)},n=function(){y(i.PLEASE_WAIT)};return window.addEventListener(O,e),window.addEventListener(k,t),window.addEventListener(g,n),function(){window.removeEventListener(O,e),window.removeEventListener(k,t),window.removeEventListener(g,n)}}}),[l]),Object(a.useEffect)((function(){if(l){var e=function(e){y(i.RECOGNITION_IN_PROGRESS);var n=e.detail.session.recognizedText;n&&t(n)},n=function(e){var n=e.detail;n.session&&n.session.streamer&&n.session.streamer.recorder&&(P.current=n.session.streamer.recorder.getAnalyserNode(),P.current.fftSize=32,P.current.smoothingTimeConstant=.95,z()),t(""),N.current=!0,y(i.START_SPEAKING)};return window.addEventListener(p,n),window.addEventListener(h,e),function(){var t=A.current;window.removeEventListener(p,n),window.removeEventListener(h,e),t&&cancelAnimationFrame(t)}}}),[z,l,t]),Object(a.useEffect)((function(){if(l){var e=function(e){var t=K(e.detail.message);if("ConnectionProblem"===t?(y(i.NO_NETWORK),c({text:F("Отсутствует подключение к интернету, попробуйте ещё раз"),error:t})):"PermissionDenied"===t?(y(i.PERMISSION_DENIED),c({text:F("Вы заблокировали доступ к микрофону"),error:t})):(y(i.UNKNOWN_ERROR),c({text:F("Неизвестная ошибка"),error:t})),"PermissionDenied"!==t){var n="Voice search error: "+t;"other"===t&&(n+=". ".concat(e.detail.message)),Object(w.a)({block:"voice-search-popup",message:n,source:"speechkit",additional:r})}x()},t=function(e){x();var t=e.detail;t.type!==j.SUCCESS_RECOGNIZE&&t.type!==j.TIMEOUT_SUCCESS||n(e)};return window.addEventListener(b,e),window.addEventListener(S,t),function(){window.removeEventListener(b,e),window.removeEventListener(S,t)}}}),[c,l,x,n,K,r]),Object(a.useEffect)((function(){if(l){var e={lang:r.lang},t=r.isAliceASR?e:r;return I(t),function(){_()}}}),[l,r,I,_]);var M=Object(a.useCallback)((function(){l&&x()}),[x,l]);return Object(U.a)(M,u),Object(V.a)({onHidden:M}),{recognitionState:C,recognizedAmplitude:m,stopVoiceInput:x,toggleStartedVoice:function(){if(l)return x();f(!0)}}}({setInputValue:E,speechKitSettings:y,onSubmit:l,errorCb:Object(a.useCallback)((function(e){L.current=e.error,c&&c(e)}),[c]),buttonRef:P,useASR:y.isAliceASR?C:I}),H=q.recognitionState,B=q.recognizedAmplitude,Z=q.stopVoiceInput,Y=q.toggleStartedVoice,J=Object(a.useCallback)((function(){(!m||m())&&Y()}),[Y,m]),X=Object(a.useRef)(0),Q=Object(a.useCallback)((function(e){var t=e<=X.current,n=D.e*e+(1-D.e)*X.current;X.current=e,n<D.b||t?x():(A(Math.min(e*D.a,1)),N(e*D.c),K(),clearTimeout(M.current),M.current=window.setTimeout((function(){z()}),D.d))}),[N,A]),$=Object(a.useMemo)((function(){return Object(f.a)(Q,100)}),[Q]);Object(a.useEffect)((function(){$(B)}),[B]),Object(a.useEffect)((function(){return!H||n?(K(),x(),clearTimeout(M.current),R(!1)):[i.NO_NETWORK,i.PERMISSION_DENIED,i.UNKNOWN_ERROR,i.ASK_FOR_PERMISSION,i.PLEASE_WAIT].includes(H)?R(!1):R(!0)}),[n,H,R,x,K]),Object(a.useEffect)((function(){d&&z()}),[d,z]);var ee=T?v.a:G,te=Object(a.useMemo)((function(){return T||{logNode:{name:"input-voice",attrs:{error:L.current}}}}),[L,T]);return Object(a.useEffect)((function(){if(d){var e=function(e){if(!(e.ctrlKey||e.altKey||e.metaKey||e.shiftKey||"Escape"!==e.key&&"Esc"!==e.key))return Z()};return document.body.addEventListener("keydown",e,{capture:!0}),function(){document.body.removeEventListener("keydown",e,{capture:!0})}}}),[d,Z]),Object(u.jsxs)(ee,Object(o.a)({innerRef:P,className:Object(D.k)({active:d,disabled:n,redesign:r},t),onClick:J,disabled:n,"aria-label":W("Голосовой поиск")},te,{children:[Object(u.jsx)("span",{className:D.j}),Object(u.jsx)("span",{className:D.j}),s]}))},H=Object(c.c)({desktop:function(e){return Object(u.jsx)(q,Object(o.a)({icon:Object(u.jsx)(s.a,{className:D.i,width:32,height:32})},e))}},{file:"depot/components/VoiceInput/index.ts"})}}]);