window.MOUSE_TRACKING=function(){var t=Object.assign({ATTENTION_MIN_DURATION:1e3,ATTENTION_MAX_INTERRUPT:6e4,VIEWPORT_CHANGE_TIMEOUT:500,REQID_CHECK_INTERVAL:1e3,ALIVE_PACKET_ENABLED:!0,ALIVE_PACKET_INTERVAL:3e3,SENDER_MAX_REQUEST_COUNT:60,SENDER_MAX_PACKET_SIZE:1e3,SENDER_REQUEST_INTERVAL:1e4,SENDER_REQUEST_CACHE_TIMEOUT:3e4,COORDINATES_SCALE:1,MOUSEMOVE_LOG:1},window.MOUSE_TRACKING_SETTINGS||{});function e(t){return function(){try{return t.apply(this,arguments)}catch(t){t.message="Mouse tracking: "+t.message,t.catchType="module:mousetracking",window.logSerpJsError(t)}}}function n(t,n){return window.setTimeout(e(t),n)}function i(t,n){return window.setInterval(e(t),n)}function r(){function r(){return(new Date).getTime()}var s=r();function o(){return Math.round((r()-s)/50)}function u(t,e){t.push(255&e)}function a(t,e){for(e=Math.max(0,0|e);e>127;)t.push(127&e|128),e>>=7;t.push(e)}function c(t,e){if(!e){var n=new Error("Mouse tracking: empty baobabId in encodeASCIIString");return n.catchType="module:mousetracking",void window.logSerpJsError(n)}for(var i=!1,r=0,s=e.length;r<s;r++){var o=e.charCodeAt(r);o<128?t.push(o):i=!0}if(i){var u=new Error("Mouse tracking: baobabId must be US-ASCII");u.additional={baobabId:e},u.catchType="module:mousetracking",window.logSerpJsError(u)}t.push(0)}function h(t){try{return window.Ya&&Ya.SerpContext[t]}catch(t){return""}}function d(e){return Math.floor(e*t.COORDINATES_SCALE)}function l(t){var e=[];return u(e,t),a(e,o()),e}var E={attention:function(t,e,n){var i=[];return u(i,110),a(i,t),a(i,e),c(i,n),i},serpItem:function(t,e,n){var i,r,s,o=[],u=(r=(i=t).getBoundingClientRect(),s=i.ownerDocument.defaultView,{top:r.top+s.scrollY,left:r.left+s.scrollX});return c(o,e),a(o,n),a(o,d(u.left)),a(o,d(u.top)),a(o,d(t.clientWidth)),a(o,d(t.clientHeight)),o},serpItems:function(t,e,n){var i=[];u(i,108),a(i,o()),a(i,t),a(i,e),a(i,n.length);for(var r=0,s=n.length;r<s;r++){var c=n[r][1];if(c)i.push.apply(i,E.serpItem(n[r][0],c,n[r][2]));else{var h=n[r][0],d=new Error("Mouse tracking: element with empty blockId");d.additional={cid:h.getAttribute("data-cid"),"log-node":h.getAttribute("data-log-node")},d.catchType="module:mousetracking",window.logSerpJsError(d)}}return i},viewport:function(t){var e=[];return u(e,103),a(e,o()),a(e,d(t[0])),a(e,d(t[1])),a(e,d(t[2])),a(e,d(t[3])),e},mouseClick:function(t,e,n,i){var r=[];return u(r,109),a(r,o()),a(r,d(t)),a(r,d(e)),c(r,n),a(r,i),r},alive:function(){return l(105)},windowFocus:function(){return l(107)},windowBlur:function(){return l(106)}},_=function(t){Object.assign(this,t||{}),this._active=!0,this._timeLast=this.timeStart,this.mouseMove(this.serpItem,this.timeStart)};_.prototype={grabberDom:null,sender:null,serpItem:null,timeStart:0,mouseMove:function(e,n){return this.serpItem&&e===this.serpItem&&50*(n-this._timeLast)<t.ATTENTION_MAX_INTERRUPT?(this._timeLast=n,!0):(this.close(),!1)},close:function(){if(this._active&&(this._active=!1,void 0!==this._timeLast&&void 0!==this.timeStart&&this.serpItem&&this.sender)){var e=this._timeLast-this.timeStart;if(50*e>t.ATTENTION_MIN_DURATION){var n=this.serpItem.getAttribute("data-log-node");n&&this.sender.enqueue(E.attention,[this.timeStart,e,n])}}}};var f=function(e){this.sender=e,this._pageTimestamp=r(),this.updateDom(),i(this.updateDom.bind(this),t.REQID_CHECK_INTERVAL)};f.prototype={reqid:"",updateDom:window.Ya.throttle((function(){var t=h("reqid");this.reqid!==t&&(this.reqid=t,this._grabDOM(),this.grabViewport())})),_grabDOM:function(){this.elements=this._getElements();var t=this.elements.map((function(t){return[t,t.getAttribute("data-log-node"),0]}),this);t.length>0&&this.sender.enqueue(E.serpItems,[50,this._pageTimestamp,t])},_getElements:function(){return Array.from(document.querySelectorAll(".serp-item[data-log-node], .RequestMeta"))},grabViewport:window.Ya.throttle((function(){var t=[window.scrollX,window.scrollY,document.documentElement.clientWidth,document.documentElement.clientHeight];this.sender.enqueue(E.viewport,[t])}),10)};var g=function(){this._ls=null;try{this._ls=localStorage}catch(t){}};g.prototype={set:function(t,e){if(this.isEnabled())try{!e||Array.isArray(e)&&!e.length?this.remove(t):this._ls.setItem(this._getLsKey(t),JSON.stringify(e))}catch(t){}},get:function(t){if(this.isEnabled())try{return JSON.parse(this._ls.getItem(this._getLsKey(t)))}catch(t){}return null},remove:function(t){if(this.isEnabled())try{this._ls.removeItem(this._getLsKey(t))}catch(t){}},isEnabled:function(){return this._ls&&"object"==typeof this._ls&&"object"==typeof JSON},_getLsKey:function(t){return"_mt__"+t}};var m={abc:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%-_",encode:function(t){for(var e,n=m.abc,i=t.length,r=[],s=i-i%3,o=0;o<s;o+=3)e=(t[o]<<16)+(t[o+1]<<8)+t[o+2],r.push(n[e>>18&63],n[e>>12&63],n[e>>6&63],n[63&e]);switch(i-s){case 1:e=t[s]<<4,r.push(n[e>>6&63],n[63&e],n[64],n[64]);break;case 2:e=(t[s]<<10)+(t[s+1]<<2),r.push(n[e>>12&63],n[e>>6&63],n[63&e],n[64])}return r.join("")}},p=function(t){Object.assign(this,t||{}),this._started=!1,this._countRequestSent=this.countRequestSentInit||0,this._packetQueue=this.packetQueueInit||[]};p.prototype={requestsTimeout:t.SENDER_REQUEST_INTERVAL,reqid:"",countRequestSentInit:0,packetQueueInit:null,enqueue:function(e,n){if(this.reqid&&this.hasQuota()&&this._packetQueue.length<t.SENDER_MAX_PACKET_SIZE){var i=e.apply(this,n);if(i)return this._packetQueue.push.apply(this._packetQueue,i),this._dumpToStorage(),this.start(),!0}return!1},flush:function(){if(this.reqid){var e=this._packetQueue.splice(0,t.SENDER_MAX_PACKET_SIZE),n=m.encode(e);window.b(null,{nodeId:Ya.SerpContext.clckId,event:"tech",type:"mousetracking",data:{no:this._countRequestSent+1,blob:n},logHref:h("retpath")}),this._dumpToStorage(),this._countRequestSent++}},start:function(){if(!this._started){this._started=!0;var t=this;n((function(){t.flush(),t._started=!1,t.hasQuota()&&t._packetQueue.length>0&&t.start()}),this.requestsTimeout)}},hasQuota:function(){return this._countRequestSent<t.SENDER_MAX_REQUEST_COUNT},_dumpToStorage:window.Ya.throttle((function(){if(this.storage&&this.storage.isEnabled()){var e=this.storage.get("data")||{};if(this._packetQueue.length>0){var n=this._packetQueue.slice(0,t.SENDER_MAX_PACKET_SIZE);e[this.reqid]=[n,r(),this._countRequestSent]}else delete e[this.reqid];this.storage.set("data",e)}}),10)};var w=function(){this._senders={},this.storage=new g,this.sendAllFromStorage(),n(this.sendAllFromStorage.bind(this),t.SENDER_REQUEST_CACHE_TIMEOUT)};w.prototype={enqueue:function(t,e){var n=h("reqid");return!!n&&("object"!=typeof this._senders[n]&&(this._senders[n]=new p({reqid:n,storage:this.storage})),this._senders[n].enqueue(t,e))},sendAllFromStorage:function(){if(this.storage&&this.storage.isEnabled()){var e=this.storage.get("data")||{},n={};this.storage.set("data",{}),Object.keys(e).forEach((function(i){var s=e[i];if(Array.isArray(s)){var o=s[0],u=s[1],a=s[2],c=r()-u;if(!(c<0||a<0||a>=t.SENDER_MAX_REQUEST_COUNT||!Array.isArray(o)||o.length<1))if(c>t.SENDER_REQUEST_CACHE_TIMEOUT)new p({reqid:i,requestsTimeout:0,countRequestSentInit:a,packetQueueInit:o}).flush();else s[0]=o.slice(0,t.SENDER_MAX_PACKET_SIZE),n[i]=s}})),this.storage.set("data",n)}}};var T=function(){this.grabberAttention=null,this.sender=new w,this.grabberDom=new f(this.sender),t.ALIVE_PACKET_ENABLED&&i(function(){this.sender.enqueue(E.alive)}.bind(this),t.ALIVE_PACKET_INTERVAL)};T.prototype={onMouseMove:function(t){var e=this.findClosestElement(t),n=o();e?this.grabberAttention&&this.grabberAttention.mouseMove(e,n)||(this.grabberAttention=new _({serpItem:e,timeStart:n,sender:this.sender,grabberDom:this.grabberDom})):(this.grabberAttention&&this.grabberAttention.close(),this.grabberAttention=null)},onMouseClick:function(t,e,n,i){var r=this.findClosestElement(t),s=Ya.SerpContext.clckId;r&&(s=r.getAttribute("data-log-node")),this.sender.enqueue(E.mouseClick,[e,n,s,i])},onWindowFocus:function(){this.sender.enqueue(E.windowFocus)},onWindowBlur:function(){this.sender.enqueue(E.windowBlur)},findClosestElement:function(t){var e;return this.grabberDom.elements&&(null===(e=this.grabberDom.elements)||void 0===e?void 0:e.find((function(e){return e.contains(t)})))}};var S=new T;function A(t,e,n){return t.addEventListener(e,n),function(){t.removeEventListener(e,n)}}var b=[];t.MOUSEMOVE_LOG&&b.push(A(document,"mousemove",window.Ya.throttle(e((function(t){S.onMouseMove(t.target)})),10))),b.push(A(document,"click",e((function(t){S.onMouseClick(t.target,t.pageX,t.pageY,t.which)}))));var v=window.Ya.debounce(e((function(){S.grabberDom.grabViewport()})),t.VIEWPORT_CHANGE_TIMEOUT);b.push(A(window,"scroll",v)),b.push(A(window,"resize",v)),b.push(A(window,"focus",e((function(){S.onWindowFocus()})))),b.push(A(window,"blur",e((function(){S.onWindowBlur()})))),window.addEventListener("spas-unmount-serp",(function(){b.forEach((function(t){return t()}))}))}"complete"===document.readyState?e(r)():window.addEventListener("load",e(r),{once:!0})},window.Ya&&window.Ya.throttle&&window.BEM&&window.w?MOUSE_TRACKING():window.Ya&&Ya.define?Ya.define("mouse-tracking",["BEM"],MOUSE_TRACKING):function(){if(window.logSerpJsError){var t=new Error("Mouse tracking requires global $ and BEM, or Ya.define");t.additional={scripts:function(){var t,e=[],n=document.getElementsByTagName("script");for(t=0;t<n.length;t++){var i=n[t],r=i.src,s=i.id,o={};r&&(o.src=r),s&&(o.id=s),e.push(o)}return e}()},logSerpJsError(t)}}();